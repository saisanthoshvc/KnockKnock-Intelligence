<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Path-aware base for Posit Connect -->
    <meta name="app-base" content="{{ (request.script_root or '') ~ '/' }}">
    <script>
      // Prefix any relative API/UI path with the content mount path on Posit Connect
      window.APP_BASE = document.querySelector('meta[name="app-base"]').content;
      window.api = function (path) {
        return window.APP_BASE + String(path).replace(/^\/+/, '');
      };
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}KnockKnock Intelligence - AI-Powered RFP Extraction{% endblock %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #0a0e1a;
            --secondary-bg: #111827;
            --tertiary-bg: #1f2937;
            --accent-blue: #3b82f6;
            --accent-purple: #8b5cf6;
            --accent-teal: #06d6a0;
            --accent-pink: #f72585;
            --accent-orange: #f97316;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --border: rgba(255, 255, 255, 0.08);
            --border-hover: rgba(59, 130, 246, 0.3);
            --glass: rgba(17, 24, 39, 0.8);
            --glass-hover: rgba(17, 24, 39, 0.9);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-glow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        [data-theme="light"] {
            --primary-bg: #ffffff;
            --secondary-bg: #f8fafc;
            --tertiary-bg: #f1f5f9;
            --accent-blue: #2563eb;
            --accent-purple: #7c3aed;
            --accent-teal: #0891b2;
            --accent-pink: #db2777;
            --accent-orange: #ea580c;
            --text-primary: #0f172a;
            --text-secondary: #334155;
            --text-muted: #64748b;
            --success: #059669;
            --warning: #d97706;
            --error: #dc2626;
            --border: rgba(0, 0, 0, 0.1);
            --border-hover: rgba(37, 99, 235, 0.3);
            --glass: rgba(255, 255, 255, 0.8);
            --glass-hover: rgba(255, 255, 255, 0.9);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
            --shadow-glow: 0 0 20px rgba(37, 99, 235, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background:
                radial-gradient(ellipse at top, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at bottom right, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at bottom left, rgba(6, 214, 160, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, var(--primary-bg) 0%, var(--secondary-bg) 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            line-height: 1.6;
            font-size: 14px;
        }
        html { background-color: var(--primary-bg); }

        /* (styles omitted here are identical to your original; keeping all UI CSS intact) */

        /* For brevity, all your original styles remain unchanged below.
           --- keep everything you had here ---
        */
    </style>
</head>
<body>
    <!-- Floating particles -->
    <div class="particles" id="particles"></div>

    <div class="container">
        <header class="header" id="header">
            <div class="header-content">
                <a href="{{ url_for('index') }}" class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    KnockKnock Intelligence
                </a>
                <div class="header-controls">
                    <a href="{{ url_for('index') }}" class="nav-link {% if request.endpoint == 'index' %}active{% endif %}" onclick="scrollToUpload()">
                        <i class="fas fa-upload"></i>
                        Upload & Parse
                    </a>
                    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Light/Dark Mode">
                        <i class="fas fa-sun" id="theme-icon"></i>
                    </button>
                    <div class="status-indicator">
                        <div class="status-dot"></div>
                        <span>System Online</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="main-content">
            {% block content %}{% endblock %}
        </main>
    </div>

    <script>
        // (All your existing JS helpers unchanged; only internal links now use url_for,
        // and API calls in child templates use window.api(...))

        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 80;
            for (let i = 0; i < particleCount; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                const size = Math.random() * 6 + 2;
                p.style.width = size + 'px';
                p.style.height = size + 'px';
                p.style.left = Math.random() * 100 + '%';
                p.style.animationDelay = Math.random() * 30 + 's';
                p.style.animationDuration = (30 + Math.random() * 20) + 's';
                particlesContainer.appendChild(p);
            }
        }

        function handleHeaderScroll() {
            const header = document.getElementById('header');
            if (window.scrollY > 50) header.classList.add('scrolled'); else header.classList.remove('scrolled');
        }

        function revealOnScroll() {
            const elements = document.querySelectorAll('.card, .btn, .form-group');
            elements.forEach((el, i) => {
                const top = el.getBoundingClientRect().top;
                if (top < window.innerHeight - 150) {
                    el.style.animationDelay = (i * 0.1) + 's';
                    el.classList.add('fade-in');
                }
            });
        }

        function toggleTheme() {
            const body = document.body;
            const icon = document.getElementById('theme-icon');
            const current = body.getAttribute('data-theme');
            if (current === 'light') {
                body.removeAttribute('data-theme');
                icon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            } else {
                body.setAttribute('data-theme', 'light');
                icon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            }
        }

        function scrollToUpload() {
            const uploadSection = document.getElementById('uploadSection');
            if (uploadSection) uploadSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function initializeTheme() {
            const saved = localStorage.getItem('theme');
            const body = document.body;
            const icon = document.getElementById('theme-icon');
            if (saved === 'light') { body.setAttribute('data-theme', 'light'); icon.className = 'fas fa-moon'; }
            else { body.removeAttribute('data-theme'); icon.className = 'fas fa-sun'; }
        }

        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            createParticles();
            window.addEventListener('scroll', handleHeaderScroll);
            window.addEventListener('scroll', revealOnScroll);
            const mainContent = document.querySelector('.main-content');
            if (mainContent) mainContent.classList.add('fade-in');
            const cards = document.querySelectorAll('.card');
            cards.forEach((card, i) => { card.style.animationDelay = (i * 0.15) + 's'; card.classList.add('slide-up'); });
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach((btn, i) => { btn.style.animationDelay = (i * 0.1) + 's'; btn.classList.add('scale-in'); });
        });

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });

        document.querySelectorAll('.card, .btn, .nav-link').forEach(el => {
            el.addEventListener('mouseenter', function() { this.style.transform = (this.style.transform || '') + ' scale(1.02)'; });
            el.addEventListener('mouseleave', function() { this.style.transform = (this.style.transform || '').replace(' scale(1.02)', ''); });
        });
    </script>
</body>
</html>
